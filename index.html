<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API Test Runner • Static (GitHub Pages)</title>
  <meta name="description" content="A single-file API testing page that runs entirely in the browser. Perfect for GitHub Pages.">
  <style>
    :root{
      --bg: #0b1020;
      --panel: #111830;
      --panel-2: #0e152b;
      --text: #e7ecff;
      --muted: #a8b0c6;
      --accent: #6ca0ff;
      --accent-2: #4dd3a6;
      --danger: #ff6b6b;
      --border: #1f2744;
      --code: #0b0f1f;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: #f6f8ff;
        --panel: #ffffff;
        --panel-2: #f4f6fd;
        --text: #0c1222;
        --muted: #506080;
        --accent: #2b67ff;
        --accent-2: #0e9f6e;
        --danger: #e03131;
        --border: #dfe5ff;
        --code: #0b1020;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),var(--panel-2));
      color:var(--text); font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .title{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title h1{font-size:22px;margin:0}
    .title small{color:var(--muted)}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.row{grid-template-columns: 1.3fr .7fr}}
    .section{padding:16px}
    .section + .section{border-top:1px dashed var(--border)}
    label{display:block;font-weight:600;margin-bottom:6px}
    input,select,textarea{width:100%;border:1px solid var(--border);background:var(--panel-2);color:var(--text);padding:10px 12px;border-radius:10px;outline:none}
    textarea{min-height:120px;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

    .grid{display:grid;grid-template-columns: 1fr 1fr; gap:12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:var(--panel-2);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.accent{background:var(--accent);border-color:transparent;color:white}
    .btn.subtle{background:transparent}
    .btn.danger{background:var(--danger);border-color:transparent;color:white}

    .pill{display:inline-flex;align-items:center;gap:8px;background:var(--panel-2);border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted)}
    .pill strong{color:var(--text)}

    .output{background:var(--code);border-radius:12px;padding:12px;border:1px solid var(--border);overflow:auto;max-height:360px}
    pre{margin:0; white-space:pre-wrap; word-wrap:break-word}

    .status-line{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .status-tag{border-radius:10px;padding:6px 10px;font-weight:700}
    .status-ok{background:rgba(77,211,166,.15);color:var(--accent-2)}
    .status-bad{background:rgba(255,107,107,.15);color:var(--danger)}

    .footer{margin-top:18px;color:var(--muted);font-size:12px}
    code.inline{background:var(--panel-2);border:1px solid var(--border);padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>API Test Runner</h1>
      <small>Single-file • Works on GitHub Pages</small>
    </div>

    <div class="card section">
      <div class="controls" style="margin-bottom:12px">
        <select id="presetSelect" title="Load a preset">
          <option value="">— Load preset —</option>
        </select>
        <button class="btn" id="loadPreset">Load</button>
        <button class="btn subtle" id="saveLocal">Save to Browser</button>
        <button class="btn subtle" id="loadLocal">Load from Browser</button>
        <button class="btn subtle" id="clearLocal">Clear Browser Save</button>
      </div>

      <div class="row">
        <div class="section" style="border:none">
          <div class="grid">
            <div>
              <label for="method">Method</label>
              <select id="method">
                <option>GET</option>
                <option>POST</option>
                <option>PUT</option>
                <option>PATCH</option>
                <option>DELETE</option>
                <option>HEAD</option>
                <option>OPTIONS</option>
              </select>
            </div>
            <div>
              <label for="url">URL</label>
              <input id="url" placeholder="https://api.example.com/endpoint" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label for="headers">Headers (JSON)</label>
            <textarea id="headers" placeholder='{"Accept":"application/json"}'></textarea>
          </div>

          <div style="margin-top:12px">
            <label for="body">Body (JSON for POST/PUT/PATCH)</label>
            <textarea id="body" placeholder='{"title":"foo","body":"bar","userId":1}'></textarea>
          </div>

          <div class="controls" style="margin-top:12px">
            <button class="btn accent" id="send">Send Request</button>
            <button class="btn" id="copyCurl">Copy as cURL</button>
            <button class="btn" id="copyConfig">Copy Test JSON</button>
            <button class="btn danger" id="reset">Reset</button>
          </div>
        </div>

        <div class="section" style="border:none">
          <label>Result</label>
          <div class="status-line" style="margin:4px 0 10px">
            <span class="pill">Status: <strong id="status">—</strong></span>
            <span class="pill">Time: <strong id="time">—</strong></span>
            <span class="pill">Size: <strong id="size">—</strong></span>
          </div>
          <div class="output"><pre id="response"><code>// Response will appear here</code></pre></div>

          <div style="margin-top:12px">
            <label>Response Headers</label>
            <div class="output" style="max-height:180px"><pre id="respHeaders"><code>// Headers</code></pre></div>
          </div>
        </div>
      </div>

      <div class="section">
        <label for="testsJson">Test Suite (JSON)</label>
        <textarea id="testsJson" placeholder="Paste or edit tests JSON here"></textarea>
        <div class="controls" style="margin-top:10px">
          <button class="btn" id="runSuite">Run Suite</button>
          <button class="btn" id="downloadSuite">Download JSON</button>
          <button class="btn" id="uploadSuiteBtn">Upload JSON</button>
          <input type="file" id="uploadSuite" accept="application/json" style="display:none" />
        </div>
        <div class="output" style="margin-top:10px;max-height:220px"><pre id="suiteLog"><code>// Suite log</code></pre></div>
      </div>

      <div class="section footer">
        <p>
          Tip: Most public APIs require CORS. Try the presets below first. For non-CORS APIs, run this page locally or use a proxy.
          This tool runs 100% in your browser (no servers).
        </p>
        <p>
          JSON preset shape: <code class="inline">[{"name":"Get Post","method":"GET","url":"https://...","headers":{},"body":{}}]</code>
        </p>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Sensible CORS-friendly presets
    const PRESETS = [
      {
        name: "JSONPlaceholder: GET /posts/1",
        method: "GET",
        url: "https://jsonplaceholder.typicode.com/posts/1",
        headers: { "Accept": "application/json" },
        body: null
      },
      {
        name: "JSONPlaceholder: POST /posts",
        method: "POST",
        url: "https://jsonplaceholder.typicode.com/posts",
        headers: { "Content-Type": "application/json" },
        body: { title: "foo", body: "bar", userId: 1 }
      },
      {
        name: "GitHub API: GET /zen",
        method: "GET",
        url: "https://api.github.com/zen",
        headers: { "Accept": "text/plain" },
        body: null
      },
      {
        name: "HTTPBin: Anything",
        method: "POST",
        url: "https://httpbin.org/anything",
        headers: { "Content-Type": "application/json" },
        body: { hello: "world" }
      }
    ];

    // Populate preset select
    const presetSelect = $("presetSelect");
    PRESETS.forEach((p, i) => {
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = p.name;
      presetSelect.appendChild(opt);
    });

    // Elements
    const methodEl = $("method");
    const urlEl = $("url");
    const headersEl = $("headers");
    const bodyEl = $("body");
    const statusEl = $("status");
    const timeEl = $("time");
    const sizeEl = $("size");
    const respEl = $("response");
    const respHeadersEl = $("respHeaders");
    const suiteEl = $("testsJson");
    const suiteLog = $("suiteLog");

    // Load default preset
    function loadPreset(idx){
      const p = PRESETS[idx];
      if(!p) return;
      methodEl.value = p.method || "GET";
      urlEl.value = p.url || "";
      headersEl.value = p.headers ? JSON.stringify(p.headers, null, 2) : "";
      bodyEl.value = p.body ? JSON.stringify(p.body, null, 2) : "";
    }

    $("loadPreset").addEventListener("click", ()=>{
      if(!presetSelect.value) return;
      loadPreset(Number(presetSelect.value));
    });

    // Helpers
    function prettyJSON(x){
      try { return JSON.stringify(x, null, 2); } catch(e){ return String(x); }
    }
    function safeParseJSON(text){
      if(!text) return undefined;
      try { return JSON.parse(text); } catch(e){ throw new Error("Invalid JSON: " + e.message); }
    }

    function buildCurl(){
      const m = methodEl.value.toUpperCase();
      const u = urlEl.value.trim();
      let h = {};
      try { h = headersEl.value ? JSON.parse(headersEl.value) : {}; } catch {}
      let b = bodyEl.value ? bodyEl.value.trim() : "";
      const parts = ["curl", "-X", JSON.stringify(m), JSON.stringify(u)];
      for(const [k,v] of Object.entries(h)){
        parts.push("-H", JSON.stringify(`${k}: ${v}`));
      }
      if(b){ parts.push("-d", JSON.stringify(b)); }
      return parts.join(" ");
    }

    async function send(){
      const method = methodEl.value.toUpperCase();
      const url = urlEl.value.trim();
      let headers = {};
      try { headers = safeParseJSON(headersEl.value) || {}; } catch(e){
        alert(e.message); return;
      }
      let body = undefined;
      if(["POST","PUT","PATCH"].includes(method)){
        try { body = bodyEl.value ? JSON.stringify(safeParseJSON(bodyEl.value)) : undefined; }
        catch(e){ alert(e.message); return; }
      }

      const ctrl = new AbortController();
      const timeout = setTimeout(()=>ctrl.abort(), 20000);
      const t0 = performance.now();
      let size = 0;
      try {
        const res = await fetch(url, { method, headers, body, signal: ctrl.signal });
        const t1 = performance.now();
        const timeMs = Math.round(t1 - t0);

        const clone = res.clone();
        const ct = res.headers.get("content-type") || "";
        let payload;
        if(ct.includes("application/json")){
          payload = await res.json();
        } else {
          payload = await res.text();
        }

        // capture size (approx) by reading clone as blob
        try { size = (await clone.blob()).size; } catch {}

        statusEl.textContent = res.status + " " + (res.statusText || "");
        statusEl.className = res.ok ? "status-ok status-tag" : "status-bad status-tag";
        timeEl.textContent = timeMs + " ms";
        sizeEl.textContent = size ? size + " bytes" : "—";

        respEl.textContent = typeof payload === "string" ? payload : prettyJSON(payload);

        const headersObj = {};
        res.headers.forEach((v,k)=> headersObj[k] = v);
        respHeadersEl.textContent = prettyJSON(headersObj);
      }
      catch(err){
        clearTimeout(timeout);
        statusEl.textContent = "Network Error";
        statusEl.className = "status-bad status-tag";
        timeEl.textContent = "—";
        sizeEl.textContent = "—";
        respEl.textContent = (err && err.name === 'AbortError') ? "Request timed out (20s)." : (err?.message || String(err));
        respHeadersEl.textContent = "// No headers";
        return;
      }
      finally {
        clearTimeout(timeout);
      }
    }

    function copy(text){
      navigator.clipboard.writeText(text).then(()=>{
        const btn = document.activeElement;
        if(btn && btn.classList.contains('btn')){
          const prev = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(()=>btn.textContent = prev, 900);
        }
      });
    }

    function currentConfig(){
      let headers={}, body;
      try { headers = headersEl.value ? JSON.parse(headersEl.value) : {}; } catch{}
      try { body = bodyEl.value ? JSON.parse(bodyEl.value) : undefined; } catch{}
      return {
        name: "Ad-hoc Request",
        method: methodEl.value.toUpperCase(),
        url: urlEl.value.trim(),
        headers, body
      };
    }

    function logToSuite(text){
      suiteLog.textContent += (suiteLog.textContent ? "\n" : "") + text;
      suiteLog.scrollTop = suiteLog.scrollHeight;
    }

    async function runTest(t){
      const {name, method, url, headers, body} = t;
      const t0 = performance.now();
      let ok = false, status=0, timeMs=0;
      try{
        const res = await fetch(url, {
          method: (method||'GET').toUpperCase(),
          headers: headers||{},
          body: ["POST","PUT","PATCH"].includes((method||'GET').toUpperCase()) && body ? JSON.stringify(body) : undefined
        });
        timeMs = Math.round(performance.now()-t0);
        status = res.status;
        ok = res.ok;
        return { ok, status, timeMs };
      }catch(e){
        timeMs = Math.round(performance.now()-t0);
        return { ok:false, status:0, timeMs, error: e?.message || String(e) };
      }
    }

    async function runSuite(){
      let tests;
      try { tests = safeParseJSON(suiteEl.value); }
      catch(e){ alert(e.message); return; }
      if(!Array.isArray(tests) || tests.length===0){
        alert('Provide an array of test objects.'); return;
      }
      suiteLog.textContent = '';
      let pass=0, fail=0;
      for(const t of tests){
        logToSuite(`▶ ${t.name || t.url}`);
        const res = await runTest(t);
        if(res.ok){ pass++; logToSuite(`  ✅ ${res.status} in ${res.timeMs}ms`); }
        else { fail++; logToSuite(`  ❌ ${res.status} in ${res.timeMs}ms` + (res.error?` — ${res.error}`:"")); }
      }
      logToSuite(`\nDone: ${pass} passed, ${fail} failed.`);
    }

    // Wire up buttons
    $("send").addEventListener("click", send);
    $("copyCurl").addEventListener("click", ()=> copy(buildCurl()));
    $("copyConfig").addEventListener("click", ()=> copy(JSON.stringify(currentConfig(), null, 2)));
    $("reset").addEventListener("click", ()=>{ methodEl.value='GET'; urlEl.value=''; headersEl.value=''; bodyEl.value=''; statusEl.textContent='—'; statusEl.className='status-tag'; timeEl.textContent='—'; sizeEl.textContent='—'; respEl.textContent='// Response will appear here'; respHeadersEl.textContent='// Headers'; });
    $("runSuite").addEventListener("click", runSuite);

    // Download / Upload suite
    $("downloadSuite").addEventListener("click", ()=>{
      const blob = new Blob([suiteEl.value||'[]'], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'api-tests.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });
    $("uploadSuiteBtn").addEventListener("click", ()=> $("uploadSuite").click());
    $("uploadSuite").addEventListener("change", (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{ suiteEl.value = reader.result; };
      reader.readAsText(file);
    });

    // Local storage helpers
    const LS_KEY = 'api-test-runner:last';
    $("saveLocal").addEventListener("click", ()=>{
      localStorage.setItem(LS_KEY, JSON.stringify(currentConfig()));
      alert('Saved to your browser.');
    });
    $("loadLocal").addEventListener("click", ()=>{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw){ alert('No saved item.'); return; }
      try { const cfg = JSON.parse(raw); methodEl.value = cfg.method||'GET'; urlEl.value = cfg.url||''; headersEl.value = cfg.headers?JSON.stringify(cfg.headers,null,2):''; bodyEl.value = cfg.body?JSON.stringify(cfg.body,null,2):''; }
      catch { alert('Corrupt save.'); }
    });
    $("clearLocal").addEventListener("click", ()=>{ localStorage.removeItem(LS_KEY); alert('Cleared.'); });

    // Seed suite area with presets as a starting point
    suiteEl.value = JSON.stringify(PRESETS, null, 2);
    // Auto-load the first preset for convenience
    loadPreset(0);
  </script>
</body>
</html>
